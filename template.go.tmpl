// Code generated by validate; DO NOT EDIT.
// github.com/protogodev/validate

package {{$.Data.PkgName}}

import (
	"fmt"
	"testing"
	"time"
	{{- range $.Imports}}
	{{.ImportString}}
	{{- end}}
	{{- range $.Data.Imports}}
	{{.ImportString}}
	{{- end}}
)

{{- $qualifiedInterfaceName := (printf "%s%s" $.Data.SrcPkgQualifier $.Data.InterfaceName) }}

func ValidateMiddleware(wrap func(error) error) func({{$qualifiedInterfaceName}}) {{$qualifiedInterfaceName}} {
	return func(next {{$qualifiedInterfaceName}}) {{$qualifiedInterfaceName}} {
		if wrap == nil {
			wrap = func(err error) error {return err}
		}
		return validateMiddleware{
			next: next,
			wrap: wrap,
		}
	}
}

type validateMiddleware struct {
	next {{$qualifiedInterfaceName}}
	wrap func(error) error
}

{{- range $.Data.Methods}}
{{- $methodName := .Name}}
{{- $methodSchema := methodSchema $methodName}}

func (mw validateMiddleware) {{$methodName}}({{.ArgList}}) {{.ReturnArgTypeList}} {
	{{- if $methodSchema}}
	schema := v.Schema{
		{{- range nonCtxParams .Params}}
		{{- $schema := index $methodSchema .Name}}
		{{- if $schema}}
		v.F("{{.Name}}", {{.Name}}): {{exprString $schema .Name .Type}},
		{{- end}} {{/* if $schema */}}
		{{- end}} {{/* range nonCtxParams .Params */}}
	}

	if err := v.Validate(schema); err != nil {
		return {{returnErr .Returns "mw.wrap(%s)"}}
	}

	{{end}} {{/* if $methodSchema */ -}}

	return mw.next.{{.Name}}({{.CallArgList}})
}
{{- end}} {{/* range $.Data.Methods */}}